import{n as A,m as F,a,j as e,C as R}from"./index-D7FDqU5o.js";import{c as n}from"./toastUtils-CJsXuu2N.js";import{C as B,H}from"./hz_logo_5-BXPBJr5J.js";import{C as M}from"./QRCodeCss-zALeVawr.js";import{p as U,a as z}from"./api-tb7qjnUV.js";import{b as G,a as j}from"./CContainer-C7AXF63h.js";import{C as $,a as Q}from"./CRow-C2L4uLiJ.js";import{C as g,a as y}from"./CCardBody-DusUn2Ju.js";import{C as S}from"./CForm-BNkHKPwx.js";import{C as m}from"./CFormInput-CRa35vWy.js";import{C as Y}from"./CInputGroup-xzT54_gP.js";const v=180,ne=()=>{const{code:d}=A(),N=F(),[T,o]=a.useState(!0),[u,b]=a.useState("CAPTURE"),[p,P]=a.useState(""),[h,E]=a.useState(""),[x,O]=a.useState(""),[I,_]=a.useState(""),[k,w]=a.useState(""),[i,D]=a.useState(""),[c,C]=a.useState(v);a.useEffect(()=>{if(!d){n("Invalid QR Code",2),o(!1);return}o(!1)},[d]),a.useEffect(()=>{if(u!=="OTP"||c<=0)return;const s=setInterval(()=>{C(r=>Math.max(0,r-1))},1e3);return()=>clearInterval(s)},[u,c]);const V=async s=>{var r,l;if(s.preventDefault(),!p||!h||!x){n("Please fill all details",2);return}try{o(!0);const t=await U({panel_token:d,name:p,email:h,phone:x});_(t.session_id),w(t.masked_destination),C(v),b("OTP"),n(`OTP sent to ${t.masked_destination}`,1)}catch(t){const f=((l=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:l.detail)||"Unable to initiate OTP";n(f,2)}finally{o(!1)}},L=async s=>{var r,l;if(s.preventDefault(),!i||i.length<4){n("Enter the OTP sent to your email",2);return}try{const t=await z({session_id:I,otp:i});n("Verified successfully",1),localStorage.setItem("access_token",t.access_token),N(`/file-viewer/${t.access_token}`)}catch(t){const f=((l=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:l.detail)||"Invalid or expired OTP";n(f,2)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(G,{children:e.jsx($,{className:"justify-content-center",children:e.jsx(Q,{md:8,children:e.jsx(M,{children:e.jsx(g,{className:"p-4 VSCFileCardBorderColor",children:e.jsxs(y,{children:[e.jsx(g,{className:"text-white VSCFileCardBorderColor",children:e.jsx(y,{className:"text-center",children:e.jsx(B,{src:H,style:{width:"100%"},alt:"Hertz Logo"})})}),T?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:180},children:e.jsx(R,{})}):u==="CAPTURE"?e.jsxs(S,{onSubmit:V,children:[e.jsx("h1",{className:"text-center",children:"Enter Your Details"}),e.jsx(m,{className:"mb-3",placeholder:"Full Name",value:p,onChange:s=>P(s.target.value)}),e.jsx(m,{className:"mb-3",type:"email",placeholder:"Email Address",value:h,onChange:s=>E(s.target.value)}),e.jsx(m,{className:"mb-3",placeholder:"Phone Number",value:x,onChange:s=>O(s.target.value.replace(/\D/g,""))}),e.jsx(j,{type:"submit",color:"primary",className:"w-100",children:"Continue"})]}):e.jsxs(S,{onSubmit:L,children:[e.jsx("h1",{className:"text-center",children:"Verify OTP"}),e.jsxs("p",{className:"text-body-secondary text-center",children:["Enter the OTP sent to ",e.jsx("b",{children:k})]}),e.jsxs(Y,{className:"mb-3",children:[e.jsx(m,{placeholder:"Enter 6-digit OTP",value:i,onChange:s=>D(s.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6}),e.jsx(j,{type:"submit",color:"success",className:"px-4 text-white",children:"Verify"})]}),e.jsxs("small",{className:"text-muted",children:["Expires in ",Math.floor(c/60),":",String(c%60).padStart(2,"0")]})]})]})})})})})})})};export{ne as default};
