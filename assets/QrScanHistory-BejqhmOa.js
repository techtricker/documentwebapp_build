import{a as l,j as e,C as T}from"./index-C_n6VyLt.js";import{m as N,c as H}from"./api-ByAZStIw.js";import{C as v,a as M}from"./CRow-DRHUpItb.js";import{C as w,a as A}from"./CCardBody-DIABjGfN.js";import{C as B}from"./CCardHeader-sVo3LTMB.js";import{C as f,a as u,b as o,c as i,d as g,e as r}from"./CTable-D0CHgu48.js";import{a as y}from"./CContainer-CjMlxGt7.js";import{C as D,a as R,b as E,c as Q,d as V}from"./CModalTitle-DPtiesJb.js";import{d as F}from"./DefaultLayout-eGTvdpHD.js";import"./index.esm-42cyg-0j.js";import"./hz_logo_5-DSclOlyI.js";import"./cil-user-Ddrdy7PS.js";const Y=()=>{const[c,_]=l.useState([]),[n,d]=l.useState(!1),[S,h]=l.useState(!1),[x,j]=l.useState([]),[t,m]=l.useState(null);l.useEffect(()=>{b()},[]);const b=async()=>{d(!0);try{const s=await N();_(s)}catch{H("Failed to load QR scan history",2)}finally{d(!1)}},L=s=>{m(s);let a=s.scan_logs;if(typeof a=="string")try{a=JSON.parse(a)}catch{a=[]}j(Array.isArray(a)?a:[]),h(!0)},C=()=>{h(!1),j([]),m(null)},p=s=>s?new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return e.jsxs(e.Fragment,{children:[e.jsx(v,{children:e.jsx(M,{xs:12,children:e.jsxs(w,{className:"mb-4",children:[e.jsx(B,{children:e.jsx("strong",{children:"QR Scan History"})}),e.jsxs(A,{children:[n&&e.jsx(T,{}),!n&&e.jsxs(f,{children:[e.jsx(u,{children:e.jsxs(o,{children:[e.jsx(i,{children:"Visitor Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Phone"}),e.jsx(i,{children:"Company"}),e.jsx(i,{children:"Panel"}),e.jsx(i,{children:"Scanned On"}),e.jsx(i,{children:"Action"})]})}),e.jsx(g,{children:c.length>0?c.map(s=>{var a;return typeof s.scan_logs=="string"?JSON.parse(s.scan_logs||"[]").length:(a=s.scan_logs)!=null&&a.length,e.jsxs(o,{children:[e.jsx(r,{children:s.visitor_name||"-"}),e.jsx(r,{children:s.visitor_email||"-"}),e.jsx(r,{children:s.visitor_phone||"-"}),e.jsx(r,{children:s.visitor_company||"-"}),e.jsx(r,{children:s.panel_name||s.panel_id}),e.jsx(r,{children:p(s.created_at)}),e.jsx(r,{children:e.jsx(y,{size:"sm",color:"primary",onClick:()=>L(s),children:"View Logs"})})]},s.user_assignment_id)}):e.jsx(o,{children:e.jsx(r,{colSpan:6,className:"text-center",children:"No record found"})})})]})]})]})})}),e.jsxs(D,{alignment:"center",visible:S,onClose:C,size:"lg",children:[e.jsx(R,{children:e.jsxs(E,{children:["Scan Logs â€“ Assignment #",t==null?void 0:t.user_assignment_id]})}),e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(u,{children:e.jsxs(o,{children:[e.jsx(i,{children:"Log ID"}),e.jsx(i,{children:"Scan Time"}),e.jsx(i,{children:"Status"})]})}),e.jsx(g,{children:x.length>0?x.map(s=>e.jsxs(o,{children:[e.jsx(r,{children:s.log_id}),e.jsx(r,{children:p(s.scan_datetime)}),e.jsx(r,{children:e.jsx(F,{color:s.verification_status==="otp_verified"?"success":"danger",children:s.verification_status})})]},s.log_id)):e.jsx(o,{children:e.jsx(r,{colSpan:3,className:"text-center",children:"No scan logs found"})})})]})}),e.jsx(V,{children:e.jsx(y,{color:"secondary",onClick:C,children:"Close"})})]})]})};export{Y as default};
