import{n as w,m as P,a as r,j as e,C as b}from"./index-CRoUJ-Kk.js";import{c as i}from"./toastUtils-BGPyRSrq.js";import{C as L,H as D}from"./hz_logo_5-CkN2Sfpu.js";import{C as V}from"./QRCodeCss-BLNj442U.js";import{u as p,q as k,a as A}from"./api-B6GpI7jj.js";import{b as F,a as M}from"./CContainer-DM8QGVfn.js";import{C as R,a as q}from"./CRow-DQagI_yU.js";import{C as j,a as y}from"./CCardBody-8UxDYOE8.js";import{C as B}from"./CForm-CW2No29V.js";import{C as H}from"./CInputGroup-J53Xm_Ua.js";import{C as G}from"./CFormInput-4Tk5A6pl.js";const g=180,S=30,te=()=>{const{code:n}=w(),v=P(),[o,f]=r.useState(!0),[N,O]=r.useState(""),[T,E]=r.useState(""),[d,I]=r.useState(""),[m,x]=r.useState(g),[h,C]=r.useState(S),c=r.useMemo(()=>{try{if(!n)return"";const a=Uint8Array.from(atob(n),s=>s.charCodeAt(0));return new TextDecoder().decode(a)}catch{return""}},[n]);r.useEffect(()=>{(async()=>{var s,l;try{if(!n){i("Invalid QR Code link",2),f(!1);return}try{c&&await p(0,c,"qr_initiated")}catch{}console.log({encoded_secret:n});const t=await k({encoded_secret:n});O(t.session_id),E(t.masked_destination),f(!1),i(`OTP sent to ${t.masked_destination}`,1),x(g),C(S)}catch(t){f(!1);const u=((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.detail)||"Failed to initiate OTP";i(u,2)}})()},[n,c]),r.useEffect(()=>{if(o||m<=0)return;const a=setInterval(()=>{x(s=>Math.max(0,s-1))},1e3);return()=>clearInterval(a)},[m,o]),r.useEffect(()=>{if(o||h<=0)return;const a=setInterval(()=>{C(s=>Math.max(0,s-1))},1e3);return()=>clearInterval(a)},[h,o]);const _=async a=>{var s,l;if(a.preventDefault(),!d||d.length<4){i("Enter the OTP sent to your email",2);return}try{const t=await A({session_id:N,otp:d});i("Verified successfully",1);try{c&&await p(0,c,"otp_verified")}catch{}v(`/file-viewer/${t.access_token}`)}catch(t){const u=((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.detail)||"Invalid or expired OTP";i(u,2)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(F,{children:e.jsx(R,{className:"justify-content-center",children:e.jsx(q,{md:8,children:e.jsx(V,{children:e.jsx(j,{className:"p-4 VSCFileCardBorderColor",children:e.jsxs(y,{children:[e.jsx(j,{className:"text-white VSCFileCardBorderColor",children:e.jsx(y,{className:"text-center",children:e.jsx(L,{src:D,style:{width:"100%"},alt:"Hertz Logo"})})}),o?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:180},children:e.jsx(b,{})}):e.jsxs(B,{onSubmit:_,children:[e.jsx("h1",{className:"text-center",children:"Verify OTP"}),e.jsxs("p",{className:"text-body-secondary text-center",children:["Enter the OTP sent to ",e.jsx("b",{children:T})]}),e.jsxs(H,{className:"mb-3",children:[e.jsx(G,{placeholder:"Enter 6-digit OTP",value:d,onChange:a=>I(a.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6}),e.jsx(M,{type:"submit",color:"success",className:"px-4 text-white",children:"Verify"})]}),e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("small",{className:"text-muted",children:["Expires in ",Math.floor(m/60),":",String(m%60).padStart(2,"0")]})})]})]})})})})})})})};export{te as default};
