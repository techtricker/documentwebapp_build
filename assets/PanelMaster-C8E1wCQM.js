import{a as s,_ as W,o as V,c as G,P as S,j as e,C as J}from"./index-CwQL2t-A.js";import{d as K,h as X,i as Y,j as Z}from"./api-tb7qjnUV.js";import{c as d}from"./toastUtils-B9v39y2b.js";import{C as ee,a as ae}from"./CRow-xZQvIvC4.js";import{C as se,a as le}from"./CCardBody-COp50SDu.js";import{C as re}from"./CCardHeader-m8c2HhZJ.js";import{C as te,a as ne,b as T,c as F,d as oe,e as j}from"./CTable-lk4-6KXX.js";import{a as c}from"./CContainer-imqrk4GV.js";import{C as q,a as B,b as L,c as D,d as H}from"./CModalTitle-DuUokrO8.js";import{C as ie}from"./CForm-8mT-ZKp0.js";import{b as $,a as A,C as de}from"./CFormInput-rTe5DLkW.js";import"./DefaultLayout-DTx8TaoL.js";import"./index.esm-30w8qYLS.js";import"./hz_logo_5-CDgMsiCN.js";import"./cil-user-Ddrdy7PS.js";const Q=s.forwardRef((r,b)=>{var{children:w,className:u,feedback:g,feedbackInvalid:t,feedbackValid:n,floatingClassName:m,floatingLabel:v,id:y,invalid:l,label:x,plainText:p,text:C,tooltipFeedback:P,valid:o}=r,h=W(r,["children","className","feedback","feedbackInvalid","feedbackValid","floatingClassName","floatingLabel","id","invalid","label","plainText","text","tooltipFeedback","valid"]);return V.createElement($,{describedby:h["aria-describedby"],feedback:g,feedbackInvalid:t,feedbackValid:n,floatingClassName:m,floatingLabel:v,id:y,invalid:l,label:x,text:C,tooltipFeedback:P,valid:o},V.createElement("textarea",Object.assign({className:G(p?"form-control-plaintext":"form-control",{"is-invalid":l,"is-valid":o},u),id:y},h,{ref:b}),w))});Q.propTypes=Object.assign({className:S.string,id:S.string,plainText:S.bool},$.propTypes);Q.displayName="CFormTextarea";const ke=()=>{const[r,b]=s.useState([]),[w,u]=s.useState(null),[g,t]=s.useState(!1),[n,m]=s.useState(""),[v,y]=s.useState(""),[l,x]=s.useState(""),[p,C]=s.useState(!1),[P,o]=s.useState(!1),[h,E]=s.useState(null),[N,k]=s.useState(null),[I,M]=s.useState(!1);s.useEffect(()=>{C(!1),R()},[]);const R=async()=>{try{const a=await K();b(a)}catch{u("Failed to load panels"),d("Internal Server Error",2)}},O=async()=>{try{p?(await Y({panel_name:n,description:l},v),d("Updated Successfully!",1)):(await Z({panel_name:n,description:l}),d("Created Successfully!",1)),m(""),x(""),t(!1),C(!1),R()}catch{d("Internal Server Error",2)}},z=async a=>{o(!0),E(a),k(null),M(!0);try{const f=await X(a);k(f.qr_code_base64)}catch{d("Failed to load QR code",2)}finally{M(!1)}},_=()=>{o(!1),E(null),k(null)},U=(a,f)=>{const i=document.createElement("a");i.href=`data:image/png;base64,${a}`,i.download=`panel-${f}-qr.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i)};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx(ae,{xs:12,children:e.jsxs(se,{className:"mb-4",children:[e.jsx(re,{children:e.jsx("strong",{children:"All Panels"})}),e.jsx(le,{children:e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(T,{children:[e.jsx(F,{children:"Panel Name"}),e.jsx(F,{children:"No. of Files"}),e.jsx(F,{children:"QR Code"})]})}),e.jsx(oe,{children:r.length>0?r.map(a=>e.jsxs(T,{children:[e.jsx(j,{children:a.panel_name}),e.jsx(j,{children:a.file_count}),e.jsx(j,{children:e.jsx(c,{size:"sm",color:"info",onClick:()=>z(a.panel_id),children:"View QR"})})]},a.panel_id)):e.jsx(T,{children:e.jsx(j,{colSpan:3,className:"text-center",children:"No record found"})})})]})})]})})}),e.jsxs(q,{alignment:"center",visible:g,onClose:()=>t(!1),children:[e.jsx(B,{children:e.jsx(L,{children:p?"Edit Panel":"Add Panel"})}),e.jsx(D,{children:e.jsxs(ie,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(A,{children:"Panel Name"}),e.jsx(de,{value:n,onChange:a=>m(a.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(A,{children:"Description"}),e.jsx(Q,{rows:3,value:l,onChange:a=>x(a.target.value)})]})]})}),e.jsxs(H,{children:[e.jsx(c,{color:"secondary",onClick:()=>t(!1),children:"Close"}),e.jsx(c,{color:"primary",onClick:O,children:"Save"})]})]}),e.jsxs(q,{alignment:"center",visible:P,onClose:_,children:[e.jsx(B,{children:e.jsx(L,{children:"Panel QR Code"})}),e.jsxs(D,{className:"text-center",children:[I&&e.jsx(J,{}),!I&&N&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`data:image/png;base64,${N}`,alt:"Panel QR",style:{width:250}}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{color:"primary",onClick:()=>U(N,h),children:"Download QR"})})]})]}),e.jsx(H,{children:e.jsx(c,{color:"secondary",onClick:_,children:"Close"})})]})]})};export{ke as default};
