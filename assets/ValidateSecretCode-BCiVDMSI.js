import{n as R,m as B,a,j as e,C as H}from"./index-CYGTJaOw.js";import{c as r,p as M,a as U}from"./api-DAU24Iu2.js";import{C as z,H as G}from"./hz_logo_5-BBORIw4s.js";import{C as $}from"./QRCodeCss-30xlTOKC.js";import{b as Q,a as g}from"./CContainer-Ujz_cX0f.js";import{C as Y,a as q}from"./CRow-BPU2Y4yv.js";import{C as y,a as N}from"./CCardBody-cSd5ecBp.js";import{C as S}from"./CForm-7sushLtk.js";import{C as o}from"./CFormInput-CSWPH7Z6.js";import{C as J}from"./CInputGroup-CY-GXBKS.js";const v=180,le=()=>{const{code:d}=R(),b=B(),[T,i]=a.useState(!0),[u,P]=a.useState("CAPTURE"),[p,E]=a.useState(""),[h,O]=a.useState(""),[x,I]=a.useState(""),[C,_]=a.useState(""),[k,w]=a.useState(""),[D,V]=a.useState(""),[c,L]=a.useState(""),[m,j]=a.useState(v);a.useEffect(()=>{if(!d){r("Invalid QR Code",2),i(!1);return}i(!1)},[d]),a.useEffect(()=>{if(u!=="OTP"||m<=0)return;const t=setInterval(()=>{j(n=>Math.max(0,n-1))},1e3);return()=>clearInterval(t)},[u,m]);const A=async t=>{var n,l;if(t.preventDefault(),!p||!h||!x||!C){r("Please fill all details",2);return}try{i(!0);const s=await M({panel_token:d,name:p,email:h,phone:x,company_name:C});w(s.session_id),V(s.masked_destination),j(v),P("OTP"),r(`OTP sent to ${s.masked_destination}`,1)}catch(s){const f=((l=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:l.detail)||"Unable to initiate OTP";r(f,2)}finally{i(!1)}},F=async t=>{var n,l;if(t.preventDefault(),!c||c.length<4){r("Enter the OTP sent to your email",2);return}try{const s=await U({session_id:k,otp:c});r("Verified successfully",1),localStorage.setItem("access_token",s.access_token),b(`/file-viewer/${s.access_token}`)}catch(s){const f=((l=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:l.detail)||"Invalid or expired OTP";r(f,2)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(Q,{children:e.jsx(Y,{className:"justify-content-center",children:e.jsx(q,{md:8,children:e.jsx($,{children:e.jsx(y,{className:"p-4 VSCFileCardBorderColor",children:e.jsxs(N,{children:[e.jsx(y,{className:"text-white VSCFileCardBorderColor",children:e.jsx(N,{className:"text-center",children:e.jsx(z,{src:G,style:{width:"100%"},alt:"Hertz Logo"})})}),T?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:180},children:e.jsx(H,{})}):u==="CAPTURE"?e.jsxs(S,{onSubmit:A,children:[e.jsx("h1",{className:"text-center",children:"Enter Your Details"}),e.jsx(o,{className:"mb-3",placeholder:"Full Name",value:p,onChange:t=>E(t.target.value)}),e.jsx(o,{className:"mb-3",type:"email",placeholder:"Email Address",value:h,onChange:t=>O(t.target.value)}),e.jsx(o,{className:"mb-3",placeholder:"Phone Number",value:x,onChange:t=>I(t.target.value.replace(/\D/g,""))}),e.jsx(o,{className:"mb-3",placeholder:"Company Name",value:C,onChange:t=>_(t.target.value)}),e.jsx(g,{type:"submit",color:"primary",className:"w-100",children:"Continue"})]}):e.jsxs(S,{onSubmit:F,children:[e.jsx("h1",{className:"text-center",children:"Verify OTP"}),e.jsxs("p",{className:"text-body-secondary text-center",children:["Enter the OTP sent to ",e.jsx("b",{children:D})]}),e.jsxs(J,{className:"mb-3",children:[e.jsx(o,{placeholder:"Enter 6-digit OTP",value:c,onChange:t=>L(t.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6}),e.jsx(g,{type:"submit",color:"success",className:"px-4 text-white",children:"Verify"})]}),e.jsxs("small",{className:"text-muted",children:["Expires in ",Math.floor(m/60),":",String(m%60).padStart(2,"0")]})]})]})})})})})})})};export{le as default};
