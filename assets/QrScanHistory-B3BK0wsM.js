import{a as l,j as e,C as T}from"./index-D6Jq3K-x.js";import{m as N,c as H}from"./api-DNt6p5pr.js";import{C as M,a as v}from"./CRow-B_wr-fKM.js";import{C as w,a as A}from"./CCardBody-BJc_-Mbn.js";import{C as B}from"./CCardHeader-CQ5ah_nf.js";import{C as f,a as u,b as i,c as t,d as g,e as a}from"./CTable-DxwI5Xhb.js";import{a as y}from"./CContainer-Dfo9oL2s.js";import{C as D,a as R,b as E,c as Q,d as V}from"./CModalTitle-DNXVKnjk.js";import{d as F}from"./DefaultLayout-DMR4_zOt.js";import"./index.esm-CbLieEqJ.js";import"./hz_logo_5-DkmOu-nl.js";import"./cil-user-Ddrdy7PS.js";const Y=()=>{const[n,S]=l.useState([]),[c,d]=l.useState(!1),[_,h]=l.useState(!1),[x,j]=l.useState([]),[o,m]=l.useState(null);l.useEffect(()=>{b()},[]);const b=async()=>{d(!0);try{const s=await N();S(s)}catch{H("Failed to load QR scan history",2)}finally{d(!1)}},L=s=>{m(s);let r=s.scan_logs;if(typeof r=="string")try{r=JSON.parse(r)}catch{r=[]}j(Array.isArray(r)?r:[]),h(!0)},C=()=>{h(!1),j([]),m(null)},p=s=>s?new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsx(v,{xs:12,children:e.jsxs(w,{className:"mb-4",children:[e.jsx(B,{children:e.jsx("strong",{children:"QR Scan History"})}),e.jsxs(A,{children:[c&&e.jsx(T,{}),!c&&e.jsxs(f,{children:[e.jsx(u,{children:e.jsxs(i,{children:[e.jsx(t,{children:"Visitor Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Panel"}),e.jsx(t,{children:"Scanned On"}),e.jsx(t,{children:"Action"})]})}),e.jsx(g,{children:n.length>0?n.map(s=>{var r;return typeof s.scan_logs=="string"?JSON.parse(s.scan_logs||"[]").length:(r=s.scan_logs)!=null&&r.length,e.jsxs(i,{children:[e.jsx(a,{children:s.visitor_name||"-"}),e.jsx(a,{children:s.visitor_email||"-"}),e.jsx(a,{children:s.panel_name||s.panel_id}),e.jsx(a,{children:p(s.created_at)}),e.jsx(a,{children:e.jsx(y,{size:"sm",color:"primary",onClick:()=>L(s),children:"View Logs"})})]},s.user_assignment_id)}):e.jsx(i,{children:e.jsx(a,{colSpan:6,className:"text-center",children:"No record found"})})})]})]})]})})}),e.jsxs(D,{alignment:"center",visible:_,onClose:C,size:"lg",children:[e.jsx(R,{children:e.jsxs(E,{children:["Scan Logs â€“ Assignment #",o==null?void 0:o.user_assignment_id]})}),e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(u,{children:e.jsxs(i,{children:[e.jsx(t,{children:"Log ID"}),e.jsx(t,{children:"Scan Time"}),e.jsx(t,{children:"Status"})]})}),e.jsx(g,{children:x.length>0?x.map(s=>e.jsxs(i,{children:[e.jsx(a,{children:s.log_id}),e.jsx(a,{children:p(s.scan_datetime)}),e.jsx(a,{children:e.jsx(F,{color:s.verification_status==="otp_verified"?"success":"danger",children:s.verification_status})})]},s.log_id)):e.jsx(i,{children:e.jsx(a,{colSpan:3,className:"text-center",children:"No scan logs found"})})})]})}),e.jsx(V,{children:e.jsx(y,{color:"secondary",onClick:C,children:"Close"})})]})]})};export{Y as default};
